<!doctype html>
<html class="bulma-dark-mode">

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0" />
		<link rel="icon" type="image/png" href="logo-192.png" />
		<title>Casterlabs Caffeinated</title>

		%sapper.base%

		<!-- Scripts -->
		<script src="https://unpkg.com/feather-icons"></script>
		<script>
			const MIN_ZOOM = -2;
			const MAX_ZOOM = 2;

			const { shell, remote, webFrame } = require("electron");
			const { app } = remote;
			const currentWindow = remote.getCurrentWindow();

			// Poll for updated zoom level, and make sure it's within proper bounds.
			{
				const zoomChangedEvent = new Event("zoom_changed");

				let expectedZoom = webFrame.getZoomLevel();

				function checkZoom(force = false) {
					const currentZoomLevel = webFrame.getZoomLevel();

					if ((expectedZoom != currentZoomLevel) || force) {
						if (currentZoomLevel < MIN_ZOOM) {
							console.warn("[UI]", "Zoom level was smaller than", MIN_ZOOM, "so it was reset.");
							webFrame.setZoomLevel(MIN_ZOOM);
							expectedZoom = MIN_ZOOM;
						} else if (currentZoomLevel > MAX_ZOOM) {
							console.warn("[UI]", "Zoom level was larger than", MAX_ZOOM, "so it was reset.");
							webFrame.setZoomLevel(MAX_ZOOM);
							expectedZoom = MAX_ZOOM;
						} else {
							console.debug("[UI]", "Zoom level has changed to", currentZoomLevel);
							expectedZoom = currentZoomLevel;
						}


						window.dispatchEvent(zoomChangedEvent);
					}
				}

				setInterval(checkZoom, 750);
				checkZoom(true);
			}

			function openLink(link) {
				console.debug("[Framework]", "Opening", link);
				shell.openExternal(link);
			}

			window.addEventListener("load", () => {
				feather.replace();
			});
		</script>
		<script type="module">
			import { setDarkMode } from "./js/ui.js";

			window.toggleDarkMode = setDarkMode;
		</script>

		<!-- Sapper creates a <script> tag containing `src/client.js`
	     and anything else it needs to hydrate the app and
	     initialise the router -->
		%sapper.scripts%

		<!-- Sapper generates a <style> tag containing critical CSS
	     for the current page. CSS for the rest of the app is
	     lazily loaded when it precaches secondary pages -->
		%sapper.styles%

		<!-- This contains the contents of the <svelte:head> component, if
	     the current page has one -->
		%sapper.head%
	</head>

	<body>
		<!-- Svelte does not preserve element order in <head> -->
		<link rel="stylesheet" href="css/bulma.min.css" />
		<link rel="stylesheet" href="css/bulma-prefers-dark.min.css" />
		<link rel="stylesheet" href="css/global.css" />
		<link rel="stylesheet" href="css/titlebar.css" />
		<link rel="stylesheet" href="css/scrollbar.css" />
		<link rel="stylesheet" href="css/sidebar.css" />


		<!-- Titlebar -->
		<div class="title-bar">
			<div class="title-bar-title">
				<img class="version-hover" src="logo-192.png" />
				<span class="current-page title is-6">
					Caffeinated
				</span>
			</div>
			<div class="title-actions">
				<span class="title is-6">
					<a class="minimize title-action" title="Minimize">
						<i data-feather="minus"></i>
					</a><a class="maximize title-action" title="Maximize">
						<i data-feather="maximize"></i>
					</a><a class="close title-action" title="Close">
						<i data-feather="x"></i>
					</a>
				</span>
			</div>
		</div>

		<div id="side-bar">

		</div>

		<section class="sapper-container">
			<!-- The application will be rendered inside this element,
	 		 because `src/client.js` references it -->
			<div id="sapper">%sapper.html%</div>
		</section>
	</body>

</html>