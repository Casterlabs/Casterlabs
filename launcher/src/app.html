<!doctype html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0" />

		<link rel="stylesheet" href="/global.css" />
		<link rel="icon" type="image/png" href="logo-192.png" />

		<title>Casterlabs Caffeinated</title>

		<script>
			const { shell, remote } = require("electron");
			const { app } = remote;
			const currentWindow = remote.getCurrentWindow();

			window.addEventListener("load", () => {
				new MutationObserver(() => {
					for (const anchor of document.querySelectorAll("a")) {

						// Intercept all rel="external" anchors and add a click listener.
						if (anchor.getAttribute("rel") == "external") {

							// On click we prevent the navigation and openLink with the href.
							// We use the onclick function rather than 
							// addEventListener("click", ...) because it helps prevent duplicates.
							anchor.onclick = () => {
								openLink(anchor.href);
								return false;
							};
						}
					}
				}).observe(document.body, {
					subtree: true,
					childList: true
				});

				const closeButton = document.querySelector("#close-button a");

				closeButton.addEventListener("click", () => {
					app.exit();
				});
			});

			function openLink(link) {
				console.debug("Opening", link);
				shell.openExternal(link);
			}
		</script>

		%svelte.head%
	</head>

	<body>
		<!-- The application will be rendered inside this element,
	     because `src/client.js` references it -->
		<div id="svelte">%svelte.body%</div>

		<div id="close-button">
			<a href="#">
				<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x">
					<line x1="18" y1="6" x2="6" y2="18"></line>
					<line x1="6" y1="6" x2="18" y2="18"></line>
				</svg>
			</a>
		</div>
	</body>

</html>